"use strict";(self.webpackChunktagspaces=self.webpackChunktagspaces||[]).push([[1996],{90236:(e,t,n)=>{n.d(t,{m:()=>o});var r=n(96540),i=n(12924);const o=()=>(0,r.useContext)(i.j)},91042:(e,t,n)=>{n.r(t),n.d(t,{default:()=>_});var r=n(74848),i=n(96488),o=n(32535),a=n(96540),s=n(69733),l=n(38291),c=n(8039),d=n(37603),u=n(91799),h=n(30073),p=n(16738),g=n(7527),m=n(12070),x=n(67172),y=n(77118),A=n(14970),f=n(32389),j=n(70704),v=n(35124),C=n(47902),D=n(14562);const T=({targetPath:e,setTargetDir:t,targetLocationID:n})=>{const{t:T}=(0,f.Bd)(),{currentLocation:b,findLocation:E,locations:F}=(0,j.L)(),{currentDirectoryEntries:P}=(0,D.L)(),{openCreateDirectoryDialog:L}=(0,C.w)(),S=(0,s.d4)(A.q6),w=(0,a.useRef)(n||b?.uuid),k=(0,a.useRef)(e),[I,W]=(0,a.useState)(P.filter(e=>!e.isFile));(0,a.useEffect)(()=>{n&&n!==b?.uuid&&E(w.current)&&M(e)},[]);const B=e=>{w.current=e.target.value;const n=E(w.current);n&&(M(n.path),t(n.path))};function M(e){k.current=e,E(w.current).listDirectoryPromise(e,[],[]).then(e=>(void 0!==e&&W(e.filter(e=>!(e.isFile||e.name===i.A.metaFolder||e.name.endsWith("/"+i.A.metaFolder)||!S&&e.name.startsWith(".")))),!0)).catch(e=>{console.log("listDirectoryPromise",e)})}return(0,r.jsxs)("div",{style:{marginTop:10},children:[function(){const e=E(w.current);return e&&e.type===x.locationType.TYPE_LOCAL?(0,r.jsxs)(u.A,{fullWidth:!0,variant:"standard",style:{flexFlow:"nowrap",alignItems:"center"},children:[(0,r.jsxs)(v.A,{style:{display:"inline"},variant:"subtitle2",children:[T("targetLocation"),":Â "]}),(0,r.jsx)(c.A,{fullWidth:!0,onChange:B,value:w.current,children:F.filter(e=>e.type===x.locationType.TYPE_LOCAL).map(e=>(0,r.jsx)(d.A,{value:e.uuid,children:(0,r.jsx)("span",{style:{width:"100%"},children:e.name})},e.uuid))})]}):null}(),(0,r.jsx)(l.A,{startIcon:(0,r.jsx)(o.SM,{}),style:{marginTop:10,marginBottom:10},"data-tid":"navigateToParentTID",onClick:()=>{if(k.current){let e=k.current;e.endsWith(b?.getDirSeparator())&&(e=e.slice(0,-1));const n=(0,y.extractContainingDirectoryPath)(e);M(n),t(n)}},children:T("core:navigateToParentDirectory")}),(0,r.jsx)(l.A,{startIcon:(0,r.jsx)(o.WE,{}),style:{marginLeft:5,marginTop:10,marginBottom:10},"data-tid":"newSubdirectoryTID",onClick:()=>{L(k.current,e=>{M(k.current),t(e)},!0)},children:T("core:newSubdirectory")}),(0,r.jsx)(h.A,{dense:!0,style:{borderRadius:i.A.defaultCSSRadius,border:"1px solid gray",maxHeight:300,overflowY:"auto"},children:I&&I.length>0?I.map(e=>(0,r.jsxs)(g.Ay,{"data-tid":"MoveTarget"+e.name,title:"Navigate to: "+e.path,onClick:()=>{t(e.path)},onDoubleClick:()=>{M(e.path)},children:[(0,r.jsx)(m.A,{style:{minWidth:35},children:(0,r.jsx)(o.iK,{})}),(0,r.jsx)(p.A,{primary:e.name})]},e.path)):(0,r.jsx)("div",{style:{padding:10},children:T("core:noSubFoldersFound")})})]})};var b=n(87729),E=n(45575),F=n(34120),P=n(90236),L=n(96984),S=n(36749),w=n(73989),k=n(95124),I=n(2788),W=n(34477),B=n(55370),M=n(25418),R=n(49565),Y=n(53356),O=n(22944);const _=function(e){const{t}=(0,f.Bd)(),n=(0,s.wA)(),{open:c,entries:d,onClose:u,targetDir:p,targetLocationId:y}=e,{findLocation:A}=(0,j.L)(),{currentDirectoryPath:C}=(0,D.L)(),{handleEntryExist:_,openEntryExistDialog:z}=(0,P.m)(),{copyFiles:H,copyDirs:U,moveFiles:q,moveDirs:K}=(0,S.E)(),{openFileUploadDialog:N}=(0,L.m)(),{selectedEntries:G}=(0,w._)(),J=d||G,[Q,V]=(0,a.useState)(p||C),X=(0,a.useRef)({}),[Z,$]=(0,a.useReducer)(e=>e+1,0,void 0),ee=A(),te=A(y),ne=J?J.filter(e=>e.isFile).map(e=>e.path):[],re=J?J.filter(e=>!e.isFile).map(e=>e.path):[];function ie(e){return e.map(e=>{const t=X.current[e];let n=0;return t&&(n=t.filesCount+t.dirsCount),{path:e,count:n}})}function oe(){n(k.o1.resetProgress()),N(p,"copyEntriesTitle"),ne.length>0&&(H(ne,Q,te.uuid,ae),V("")),re.length>0&&U(ie(re),Q,te.uuid,ae),u(!0)}(0,a.useEffect)(()=>{if(re.length>0&&i.A.isElectron&&ee&&!ee.haveObjectStoreSupport()&&!ee.haveWebDavSupport()){const e=re.map(e=>(0,I.TA)(e).then(t=>(X.current[e]=t,!0)).catch(e=>{console.debug("getDirProperties:",e)}));Promise.all(e).then(()=>$())}},[]);const ae=(e,t,r)=>{n(k.o1.onUploadProgress(e,t,r))};function se(){ne.length>0&&(q(ne,Q,te.uuid,ae,!0,!0),V("")),re.length>0&&(n(k.o1.resetProgress()),N(void 0,"moveEntriesTitle"),K(ie(re),Q,te.uuid,ae)),u(!0)}function le(e){_(J,Q).then(t=>{t?z(t,()=>{e?oe():se()}):e?oe():se()})}const ce=(0,Y.A)(),de=(0,O.A)(ce.breakpoints.down("md"));return(0,r.jsxs)(B.A,{open:c,onClose:()=>u(),keepMounted:!0,scroll:"paper","aria-labelledby":"draggable-dialog-title",PaperComponent:de?R.A:b.A,fullScreen:de,children:[(0,r.jsx)(F.A,{dialogTitle:t("core:copyMoveEntriesTitle"),closeButtonTestId:"closeMCFilesTID",onClose:u}),(0,r.jsxs)(M.A,{style:{overflow:"hidden"},children:[(0,r.jsx)(v.A,{variant:"subtitle2",children:t("selectedFilesAndFolders")}),(0,r.jsx)(h.A,{dense:!0,style:{overflowY:"auto",width:550,maxHeight:200},children:J.length>0&&J.map(e=>(0,r.jsxs)(g.Ay,{title:e.path,children:[(0,r.jsx)(m.A,{children:e.isFile?(0,r.jsx)(o.oS,{}):(0,r.jsx)(o.sj,{})}),(0,r.jsxs)(v.A,{variant:"subtitle2",noWrap:!0,children:[e.name,X.current[e.path]&&" ("+t("fileSize")+": "+(0,x.formatBytes)(X.current[e.path].totalSize)+")"]})]},e.path))}),(0,r.jsx)(T,{setTargetDir:V,targetPath:Q,targetLocationID:te?.uuid}),(0,r.jsx)(W.A,{style:{marginTop:10},children:Q?(0,r.jsx)(v.A,{variant:"subtitle2",children:t("moveCopyToPath")+": "+Q}):(0,r.jsx)(v.A,{variant:"subtitle2",children:t("chooseTargetLocationAndPath")})})]}),(0,r.jsxs)(E.A,{children:[(0,r.jsx)(l.A,{"data-tid":"closeMoveCopyDialog",onClick:()=>u(),children:t("core:cancel")}),(!i.A.isAndroid||0===re.length)&&(0,r.jsx)(l.A,{"data-tid":"confirmMoveFiles",disabled:!Q||Q===C,onClick:()=>le(!1),variant:"contained",children:t("core:moveEntriesButton")}),(0,r.jsx)(l.A,{onClick:()=>le(!0),"data-tid":"confirmCopyFiles",disabled:!Q||Q===C,variant:"contained",children:t("core:copyEntriesButton")})]})]})}}}]);
//# sourceMappingURL=1996.bundle.js.map